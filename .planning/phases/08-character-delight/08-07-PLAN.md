---
phase: 08-character-delight
plan: 07
type: execute
wave: 2
depends_on: ["08-01"]
files_modified:
  - src/components/checkout/GuestCheckout.tsx
  - src/components/checkout/ShippingCalculator.tsx
  - src/components/checkout/PaymentMethods.tsx
  - src/components/checkout/CheckoutForm.tsx
  - src/lib/shipping.ts
  - src/data/countries.ts
autonomous: false
---

<objective>
Elevate checkout experience with guest checkout, European shipping calculator, and premium payment method display.

Purpose: Reduce checkout friction, provide accurate shipping costs, and display payment options for maximum conversion.
Output: Streamlined, professional checkout flow matching luxury e-commerce standards.
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-plan.md
@~/.claude/get-shit-done/templates/summary.md
@~/.claude/get-shit-done/references/checkpoints.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/phases/08-character-delight/08-01-SUMMARY.md
@src/components/checkout/CheckoutForm.tsx
@src/components/checkout/ShippingForm.tsx
</context>

<tasks>

<task type="auto">
  <name>Task 1: Add guest checkout with email capture and account creation option</name>
  <files>src/components/checkout/GuestCheckout.tsx, src/components/checkout/CheckoutForm.tsx</files>
  <action>
Streamline checkout to reduce abandonment:

**Guest checkout flow:**
- Default mode: Guest checkout (no account required)
- Email captured first: "Votre adresse email" (required)
- Email validation on blur: isValidEmail check
- Show checkbox: "Créer un compte pour suivre vos commandes" (optional)
- If checked: Password field appears (min 8 chars, secure password requirements)
- Account creation happens after successful order (not blocking)

**Email benefits messaging:**
- Below email input: "Recevez la confirmation et le suivi de votre commande"
- Trust signal: Lock icon + "Vos données sont sécurisées"
- No marketing opt-in by default (GDPR compliance)

**Returning customer flow:**
- Link above form: "Déjà client ? Connectez-vous"
- Opens login modal (placeholder for future auth system)
- Pre-fills shipping address for logged users
- For MVP: Just show link, clicking shows "Fonctionnalité à venir" message

**Form structure reorganization:**
- Section 1: Email + optional account creation
- Section 2: Shipping information (existing ShippingForm)
- Section 3: Shipping method selection (new - see Task 2)
- Section 4: Payment (existing, enhanced in Task 3)
- Progress indicator: "1/4 Email" → "2/4 Livraison" → etc.

**Visual design:**
- Section headers with step numbers (1️⃣, 2️⃣, etc.)
- Collapsible sections: Completed sections collapse, current section expanded
- Checkmark icon when section complete
- Smooth accordion animations (Framer Motion)

**Integration:**
- Refactor CheckoutForm to include GuestCheckout component
- Email stored in order data (for confirmation email placeholder)
- Optional password stored in localStorage (future account creation)
  </action>
  <verify>Guest checkout works without account, email validation accurate, optional account checkbox shows password field</verify>
  <done>Guest checkout streamlined, email capture smooth, account creation optional, form reorganized with sections</done>
</task>

<task type="auto">
  <name>Task 2: Create European shipping cost calculator with country selection</name>
  <files>src/components/checkout/ShippingCalculator.tsx, src/lib/shipping.ts, src/data/countries.ts</files>
  <action>
Build shipping calculator for European countries:

**Country data (src/data/countries.ts):**
- List of European countries with ISO codes
- Categories: France, EU (Schengen), EU (non-Schengen), Non-EU Europe
- Example: { code: 'FR', name: 'France', region: 'france' }
- Include major markets: France, Germany, Belgium, Netherlands, Italy, Spain, Switzerland, UK, etc.

**Shipping rates (src/lib/shipping.ts):**
- France: €5.90 (standard), €9.90 (express 24h)
- EU Schengen: €8.90 (standard 3-5 days), €15.90 (express 2-3 days)
- EU non-Schengen: €11.90 (standard 5-7 days)
- Switzerland/UK: €14.90 (standard 7-10 days)
- Free shipping threshold: None (per requirements)
- Calculate based on country code + shipping method

**ShippingCalculator component:**
- Country dropdown (searchable select, sorted alphabetically)
- Auto-detect country from browser locale as default (navigator.language)
- Shipping method radio buttons:
  - Standard (Colissimo Suivi)
  - Express (Chronopost)
- Display calculated cost: "Frais de livraison : €X.XX"
- Delivery estimate: "Livraison estimée : 3-5 jours ouvrés"
- Real-time updates when country/method changes

**Visual design:**
- Shipping cost displayed prominently (large, primary color)
- Delivery time in muted text below cost
- Truck icon next to shipping method options
- Flag emoji for selected country (visual aid)
- Smooth transitions when cost updates (number count animation)

**Integration:**
- Add to CheckoutForm between shipping address and payment
- Update OrderSummary to show shipping cost breakdown
- Store shipping cost in order total calculation
- Validate country matches shipping address country

**Edge cases:**
- If cart total > €200: Show customs warning for non-EU countries
- Out of delivery zone: Show "Livraison non disponible" with contact support link
- Invalid country selection: Disable checkout button until valid
  </action>
  <verify>Country dropdown works, shipping cost calculates correctly for different countries/methods, delivery estimates show</verify>
  <done>Shipping calculator accurate for European countries, costs clear, delivery estimates realistic, integration seamless</done>
</task>

<task type="auto">
  <name>Task 3: Display payment method icons and secure payment messaging</name>
  <files>src/components/checkout/PaymentMethods.tsx, src/components/checkout/CheckoutForm.tsx</files>
  <action>
Enhance payment section for trust and clarity:

**Payment method display:**
- Accepted payment icons in header:
  - Visa, Mastercard, American Express
  - PayPal (future integration)
  - Apple Pay, Google Pay (future integration)
- Icon size: 40px height, maintain aspect ratio
- Grayscale by default, color on hover
- Aligned horizontally with subtle spacing

**Secure payment messaging:**
- Lock icon + "Paiement 100% sécurisé"
- SSL badge/icon
- "Vos informations bancaires ne sont jamais stockées" (trust message)
- 3D Secure logo for card payments
- Position: Above payment form

**Payment placeholder (MVP):**
- Message: "Le paiement sera activé prochainement"
- Explanation: "Votre commande sera créée en attente de paiement"
- Mock payment form fields (disabled):
  - Card number (16 digits, formatted: XXXX XXXX XXXX XXXX)
  - Expiry date (MM/YY)
  - CVV (3 digits)
  - Cardholder name
- Stripe branding: "Powered by Stripe" (future integration ready)

**Future-ready structure:**
- PaymentMethods component accepts paymentGateway prop ('stripe' | 'paypal' | 'mock')
- Stripe integration hooks placeholder (useStripe, useElements commented out)
- Payment intent creation function stubbed
- Error handling structure ready

**Visual design:**
- Payment icons: Premium card images (not generic)
- Form fields: Same style as shipping form
- Secure badges: Subtle, not overwhelming
- Trust signals positioned strategically (above fold)

**Integration:**
- Add PaymentMethods to CheckoutForm (final section)
- Show payment icons in cart page (build trust early)
- Include security messaging on product pages (near CTA)
  </action>
  <verify>Payment method icons display correctly, secure messaging clear, mock form fields styled, future Stripe integration prepared</verify>
  <done>Payment section professional and trust-building, icons display accepted methods, placeholder ready for Stripe integration</done>
</task>

<task type="checkpoint:human-verify" gate="blocking">
  <what-built>Checkout excellence: guest checkout flow, European shipping calculator, premium payment display</what-built>
  <how-to-verify>
    1. Run: npm run dev
    2. **Test Guest Checkout:**
       - Add items to cart, proceed to checkout
       - Verify email field appears first
       - Enter invalid email, check validation error on blur
       - Enter valid email, verify no error
       - Check "Créer un compte" checkbox, verify password field appears
       - Uncheck, verify password field hides smoothly
       - Confirm "Déjà client ?" link present (even if placeholder)
    3. **Test Shipping Calculator:**
       - In checkout form, locate country dropdown
       - Verify France selected by default (or browser locale country)
       - Change country to Germany, verify shipping cost updates
       - Select different countries (EU, non-EU), check costs change
       - Switch shipping method (standard/express), verify cost updates
       - Check delivery estimate shows correct timeframe
       - Verify OrderSummary reflects shipping cost
       - Test edge case: Select non-EU country, check customs warning
    4. **Test Payment Section:**
       - Scroll to payment section in checkout
       - Verify payment method icons display (Visa, Mastercard, etc.)
       - Hover over icons, check color effect (if implemented)
       - Check secure payment messaging clear and visible
       - Verify mock payment fields disabled (placeholder state)
       - Confirm "Powered by Stripe" or similar future-ready branding
       - Check lock icon and SSL messaging present
    5. **Overall checkout flow:**
       - Complete entire checkout from start to finish
       - Verify section progression logical (email → shipping → payment)
       - Check progress indicator updates correctly
       - Confirm collapsible sections work (completed sections collapse)
       - Test form validation prevents submission with errors
       - Verify order total includes shipping cost
       - Submit order, confirm success with all data captured
    6. **Quality check:**
       - Guest checkout reduces friction (no forced account)
       - Shipping costs accurate and transparent
       - Payment section builds trust with security messaging
       - All animations smooth (section collapse, cost updates)
       - Mobile: Form responsive and usable
       - No performance issues during checkout
  </how-to-verify>
  <resume-signal>Type "approved" to continue, or describe specific issues to fix</resume-signal>
</task>

</tasks>

<verification>
Before declaring plan complete:
- [ ] npm run build succeeds with no errors
- [ ] Guest checkout works without forced account creation
- [ ] Email validation accurate and user-friendly
- [ ] Shipping calculator computes costs correctly for EU countries
- [ ] Country dropdown searchable and sorted
- [ ] Payment method icons display properly
- [ ] Secure payment messaging clear and trust-building
- [ ] Mock payment form styled and disabled (ready for Stripe)
- [ ] Checkout flow logical and smooth
- [ ] OrderSummary reflects shipping costs
- [ ] Mobile checkout responsive and usable
</verification>

<success_criteria>

- All tasks completed
- Guest checkout streamlined and friction-free
- European shipping costs accurate and transparent
- Payment section professional and trust-building
- Checkout flow optimized for conversion
- Future Stripe integration prepared (hooks stubbed)
- User tested and approved checkout experience
- No abandonment caused by UX friction
  </success_criteria>

<output>
After completion, create `.planning/phases/08-character-delight/08-07-SUMMARY.md`
</output>
