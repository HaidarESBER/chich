---
phase: 08-character-delight
plan: 05
type: execute
wave: 2
depends_on: ["08-01"]
files_modified:
  - src/components/product/RelatedProducts.tsx
  - src/components/product/UrgencyIndicators.tsx
  - src/components/marketing/ExitIntentModal.tsx
  - src/app/produits/[slug]/ProductDetailClient.tsx
  - src/app/layout.tsx
  - src/lib/recommendations.ts
autonomous: false
---

<objective>
Implement conversion optimization features with product recommendations, urgency indicators, and exit-intent capture.

Purpose: Increase average order value and reduce cart abandonment through psychological triggers and intelligent suggestions.
Output: Proven e-commerce conversion tactics integrated seamlessly into premium brand experience.
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-plan.md
@~/.claude/get-shit-done/templates/summary.md
@~/.claude/get-shit-done/references/checkpoints.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/08-character-delight/08-01-SUMMARY.md
@src/app/produits/[slug]/ProductDetailClient.tsx
@src/data/products.ts
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create related products recommendation carousel</name>
  <files>src/components/product/RelatedProducts.tsx, src/lib/recommendations.ts, src/app/produits/[slug]/ProductDetailClient.tsx</files>
  <action>
Build intelligent product recommendation system:

**Recommendation logic (src/lib/recommendations.ts):**
- Primary: Products in same category (exclude current product)
- Secondary: Products with similar price range (±30%)
- Tertiary: Featured products as fallback
- Return 4-6 related products maximum
- Randomize selection (different recommendations on each visit)
- Filter out of stock products from recommendations

**RelatedProducts carousel:**
- Horizontal scrollable carousel (overflow-x-auto)
- Shows 4 products on desktop, 2.5 on tablet, 1.5 on mobile (partial peek encourages scroll)
- Smooth scroll snap (scroll-snap-type: x mandatory)
- Arrow buttons (left/right) on desktop (hidden if all products visible)
- Touch-friendly swipe scrolling on mobile
- Product cards smaller than catalog (compact variant)

**Product card variant:**
- Image (square ratio, 200x200px)
- Product name (truncated to 2 lines)
- Price (prominent)
- Star rating (if reviews exist)
- Quick "Ajouter" button (icon only, + symbol)
- Hover: image zoom and card lift (consistent with catalog cards)

**Section design:**
- Heading: "Vous aimerez aussi" or "Articles similaires"
- Subheading: "Sélection basée sur ce produit"
- Section spacing: 80px margin top (clear separation from product details)
- Background: subtle background-secondary for visual grouping

**Integration:**
- Add to product detail page below reviews section
- Lazy load carousel (intersection observer - load when scrolled near)
- Track recommendation clicks for analytics placeholder

**Animations:**
- Carousel entrance: stagger cards (0.1s delay between each)
- Scroll smooth (CSS scroll-behavior: smooth)
- Card hover: scale 1.02 with shadow enhancement
  </action>
  <verify>Related products carousel shows relevant suggestions, scrolls smoothly, cards match catalog design, adds to cart works</verify>
  <done>Recommendation system intelligent, carousel smooth and responsive, integration seamless, analytics-ready</done>
</task>

<task type="auto">
  <name>Task 2: Add urgency indicators with countdown timers and limited offers</name>
  <files>src/components/product/UrgencyIndicators.tsx, src/data/products.ts</files>
  <action>
Implement psychological urgency triggers (use sparingly for authenticity):

**Time-limited offer banner:**
- Countdown timer: "Offre limitée : encore XX:XX:XX"
- Red/orange gradient background (urgent but not garish)
- Clock icon + timer display (hours:minutes:seconds)
- Live countdown using setInterval (updates every second)
- Timer syncs to end of current day: new Date().setHours(23,59,59)
- Position: Above "Ajouter au panier" button on product detail
- Animated entrance: slide down from y: -20 → 0

**Social proof urgency:**
- "X personnes consultent ce produit actuellement"
- Eye icon + dynamic count (3-12 people, randomized but stable per session)
- Subtle pulse animation on count
- Position: Below product title
- Only show on products with stockLevel < 20 (scarcity reinforcement)

**Recent purchase indicator:**
- "Dernière commande : il y a X minutes" (3-45 min range, randomized)
- Shopping bag icon + timestamp
- Fades in after 2s page load (appears naturally)
- Only on products with 4+ star reviews (authentic signal)

**Urgency rules (avoid overuse):**
- Max 1 urgency indicator per product
- Prioritize: Stock < 5 → Recent purchase → Time offer → Social proof
- 30% of products show no urgency (feels authentic)
- Store urgency state in sessionStorage (consistent per visit)

**Visual design:**
- Subtle animations (gentle pulse, not aggressive flashing)
- Brand-consistent colors (red accent #DC2626 for urgency, not neon)
- Icons match existing icon style (heroicons)
- Typography: Inter font, medium weight

**Technical implementation:**
- useEffect for countdown timer (cleanup on unmount)
- sessionStorage for view count persistence
- Math.random with seed for consistent randomization
- AnimatePresence for entrance animations
  </action>
  <verify>Urgency indicators display appropriately (not on every product), countdown timer updates live, social proof feels authentic</verify>
  <done>Urgency system creates FOMO without feeling manipulative, timers accurate, authenticity maintained</done>
</task>

<task type="auto">
  <name>Task 3: Create exit-intent modal with first-purchase discount offer</name>
  <files>src/components/marketing/ExitIntentModal.tsx, src/app/layout.tsx</files>
  <action>
Build exit-intent capture modal to reduce abandonment:

**Exit detection:**
- Trigger when mouse leaves viewport at top (window mouseleave event)
- Track mouseY position: trigger if y < 10 and velocity indicates upward movement
- Desktop only (not effective on mobile)
- Show once per session (sessionStorage flag: 'exit-intent-shown')
- Don't show on cart/checkout pages (already committed)
- 3-second minimum time on page before eligible (avoid immediate popup)

**Modal content:**
- Headline: "Attendez ! Première commande ?"
- Subheadline: "Profitez de 10% de réduction sur votre première commande"
- Discount code display: "CODE: BIENVENUE10" (large, copyable, with copy button)
- Email input: "Recevez votre code par email"
- CTA button: "Obtenir ma réduction"
- Dismiss: X close button + "Non merci" text link

**Visual design:**
- Premium modal (not popup - avoid popup blocker feel)
- Centered overlay, max-width 500px
- Backdrop: charcoal 70% opacity
- Slide + scale animation: scale 0.9 → 1, opacity 0 → 1
- Brand colors, elegant typography (Cormorant Garamond heading)
- Cloud/smoke graphic element (reinforces "Nuage" brand)

**Email capture:**
- Input validation: isValidEmail check
- Submit button: "Envoyer le code"
- Success state: "Code envoyé ! Vérifiez votre boîte mail."
- Error handling: "Email invalide, veuillez réessayer."
- Email stored in localStorage (future email marketing)
- Form submission prevents default (no actual email for MVP - placeholder)

**User experience:**
- Non-intrusive: easy to dismiss (ESC key, X button, "Non merci" link)
- Clear value proposition (10% discount)
- Social proof: "Rejoignez +500 clients satisfaits" (small text)
- Mobile: Don't show (exit intent doesn't work on mobile)

**Conversion optimization:**
- A/B test ready (track show/dismiss/submit events)
- Analytics placeholder events: exitIntentShown, exitIntentDismissed, exitIntentConverted
- Discount code copyable with click (auto-copies to clipboard)
  </action>
  <verify>Exit-intent triggers on mouse leave (desktop), modal styled premium, email validation works, shows once per session</verify>
  <done>Exit-intent modal captures abandoning visitors, offer compelling, UX non-intrusive, email capture functional</done>
</task>

<task type="checkpoint:decision" gate="blocking">
  <decision>Select discount strategy and pricing for conversion features</decision>
  <context>
The exit-intent modal offers 10% discount, but you may want different percentage or strategy.
Also need to confirm approach for urgency indicators (daily reset timer vs. static offers).
  </context>
  <options>
    <option id="standard">
      <name>Standard 10% first-purchase discount</name>
      <pros>Common conversion rate, easy to calculate, attractive to customers without eroding margins significantly</pros>
      <cons>May attract discount-hunters, 10% might not be compelling enough for premium products</cons>
    </option>
    <option id="premium">
      <name>€10 off first order €50+ (no percentage)</name>
      <pros>Increases average order value, feels more premium (flat discount), encourages basket building</pros>
      <cons>More complex to communicate, requires minimum purchase, may exclude small orders</cons>
    </option>
    <option id="aggressive">
      <name>15% first-purchase + free shipping</name>
      <pros>Very compelling offer, maximizes conversion, creates strong first impression</pros>
      <cons>Higher margin impact, may set expectation for future discounts, reduces perceived product value</cons>
    </option>
  </options>
  <resume-signal>Select: standard, premium, or aggressive (or describe custom strategy)</resume-signal>
</task>

</tasks>

<verification>
Before declaring plan complete:
- [ ] npm run build succeeds with no errors
- [ ] Related products carousel shows relevant suggestions
- [ ] Carousel scrolls smoothly on desktop and mobile
- [ ] Urgency indicators display on appropriate products (not all)
- [ ] Countdown timer updates live and resets daily
- [ ] Social proof numbers feel authentic (not obviously fake)
- [ ] Exit-intent modal triggers correctly on mouse leave
- [ ] Modal shows once per session (sessionStorage works)
- [ ] Email validation and discount code copy functional
- [ ] All features styled consistently with brand
- [ ] Conversion tactics feel premium, not desperate
</verification>

<success_criteria>

- All tasks completed
- Product recommendations increase browsing
- Urgency indicators create appropriate FOMO
- Exit-intent captures abandoning visitors
- All tactics feel authentic and premium (not manipulative)
- User approved discount strategy
- Analytics events ready for tracking
- No negative impact on brand perception
  </success_criteria>

<output>
After completion, create `.planning/phases/08-character-delight/08-05-SUMMARY.md`
</output>
