---
phase: 08-character-delight
plan: 04
type: execute
wave: 1
depends_on: []
files_modified:
  - src/components/product/SwipeableGallery.tsx
  - src/components/mobile/BottomSheet.tsx
  - src/components/mobile/FloatingCartButton.tsx
  - src/app/produits/[slug]/ProductDetailClient.tsx
  - src/app/produits/page.tsx
autonomous: false
---

<objective>
Optimize mobile experience with swipeable galleries, bottom sheet UI, and thumb-friendly navigation.

Purpose: Create premium mobile-first interactions that match native app UX quality for mobile shoppers.
Output: Mobile gestures and UI patterns that feel natural and effortless on touch devices.
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-plan.md
@~/.claude/get-shit-done/templates/summary.md
@~/.claude/get-shit-done/references/checkpoints.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@src/app/produits/[slug]/ProductDetailClient.tsx
@src/app/produits/page.tsx
@src/components/cart/CartButton.tsx
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create swipeable product image galleries for mobile</name>
  <files>src/components/product/SwipeableGallery.tsx, src/app/produits/[slug]/ProductDetailClient.tsx</files>
  <action>
Build touch-friendly swipeable gallery using Framer Motion drag gestures:

**Swipe behavior:**
- Horizontal swipe to navigate between product images
- Drag threshold: 50px to trigger image change
- Swipe left: next image, swipe right: previous image
- Snap to position after swipe (no partial images)
- Momentum scrolling (velocity-based snap)
- Resistance at start/end (elastic bounce back if at edge)

**Visual feedback:**
- Dots indicator below gallery (filled dot = current image)
- Dot count matches image count (max 5 dots, "1/8" text for 6+ images)
- During drag: current image follows finger with resistance
- Next/previous images partially visible at edges (10% peek)
- Smooth spring animation on release

**Desktop fallback:**
- Click dots to navigate
- Arrow buttons left/right (appear on hover)
- Keyboard: arrow keys navigate

**Technical implementation:**
- Use Framer Motion drag constraints
- Detect swipe velocity and direction
- Calculate snap position based on drag distance
- PanInfo from drag events for velocity
- Touch-action: pan-y (allow vertical scroll while dragging horizontally)

**Mobile optimizations:**
- Disable thumbnail clicks on mobile (swipe only)
- Full-width images on mobile
- Larger touch targets for dots (44x44px minimum)
- No hover states (touch-only interactions)

**Integration:**
- Replace current ProductDetailClient gallery on mobile (<768px)
- Keep existing desktop gallery behavior unchanged
- Use responsive detection: const isMobile = useMediaQuery('(max-width: 768px)')
  </action>
  <verify>On mobile, swipe left/right changes images smoothly, dots update, momentum feels natural, desktop unchanged</verify>
  <done>Swipeable gallery works perfectly on touch devices, snap animations smooth, desktop fallback functional</done>
</task>

<task type="auto">
  <name>Task 2: Create bottom sheet component for mobile filters and quick-view</name>
  <files>src/components/mobile/BottomSheet.tsx, src/app/produits/page.tsx</files>
  <action>
Build bottom sheet UI pattern for mobile (iOS/Android native style):

**Bottom sheet behavior:**
- Slides up from bottom of screen
- Backdrop dims page content (charcoal 60% opacity)
- Drag handle at top (centered, rounded pill, 40x4px)
- Swipe down to close (drag threshold: 100px)
- Tap backdrop to close
- ESC key closes (accessibility)
- Body scroll lock when open
- Spring animation for open/close

**Content areas:**
- Header: Title + close button (X icon)
- Body: Scrollable content (max-height: 80vh)
- Footer (optional): Sticky CTA buttons

**Use cases:**
1. **Product filters (catalog page):**
   - "Filtres" button opens bottom sheet on mobile
   - Contains ProductFilters component
   - Footer: "Appliquer les filtres" button + "Réinitialiser"
   - Shows active filter count badge on button

2. **Quick-view (product preview):**
   - Opens in bottom sheet instead of modal on mobile
   - Optimized layout for portrait orientation
   - Scrollable product info

**Technical implementation:**
- Framer Motion for slide animation and drag
- Portal rendering (createPortal to body)
- Focus trap (trap focus inside sheet when open)
- Prevent background scroll (useEffect with document.body.style.overflow)
- Drag gesture with Framer Motion dragConstraints

**Animation:**
- Open: y: 100% → 0% (300ms spring)
- Close: y: 0% → 100% (250ms ease)
- Backdrop: opacity 0 → 1 concurrent with slide

**Integration:**
- Add "Filtres" button to catalog page (mobile only, fixed at bottom)
- Bottom sheet replaces modal on mobile for quick-view
- Use useMediaQuery to detect mobile and render appropriate UI
  </action>
  <verify>Bottom sheet slides up smoothly, swipe down closes, filters work inside sheet, backdrop dims correctly</verify>
  <done>Bottom sheet component fully functional, native-feeling gestures, integrated for filters and quick-view</done>
</task>

<task type="auto">
  <name>Task 3: Add floating cart button for mobile thumb-friendly access</name>
  <files>src/components/mobile/FloatingCartButton.tsx, src/app/layout.tsx</files>
  <action>
Create floating action button (FAB) for cart access on mobile:

**Position & behavior:**
- Fixed position: bottom-right corner (16px from edges)
- Visible on all pages except checkout/cart (hide on those pages)
- Thumb zone optimized (within easy reach for right-handed users)
- Elevation shadow to indicate clickable
- Stays above page content (z-index: 40)

**Visual design:**
- Circular button (56x56px - standard FAB size)
- Background: primary color (#2C2C2C)
- Cart icon (white, 24px)
- Badge showing cart item count (red dot, white number)
- Badge position: top-right of button
- Badge animation: scale spring when count changes

**Interactions:**
- Tap navigates to cart page
- If cart empty: subtle shake animation (indicate empty)
- When item added: button pulses with scale animation
- Haptic feedback simulation (scale pulse on tap)
- Long press: show cart preview tooltip (future enhancement placeholder)

**Scroll behavior:**
- Show after scrolling 200px down (avoid covering hero content)
- Slide in from right: x: 100px → 0px
- Slide out when scrolling up past threshold
- Smooth spring transitions

**Mobile only:**
- Display only on screens <768px width
- Desktop uses header cart button (no FAB)

**Integration:**
- Add to root layout.tsx wrapped in mobile detection
- Connect to CartContext for item count
- Listen to cart changes and animate badge
- Hide on /panier and /commande routes
  </action>
  <verify>FAB appears in bottom-right on mobile, badge shows count, tapping navigates to cart, animations smooth</verify>
  <done>Floating cart button thumb-friendly and accessible, badge updates with animation, scroll behavior smooth</done>
</task>

<task type="checkpoint:human-verify" gate="blocking">
  <what-built>Mobile-first gesture enhancements: swipeable galleries, bottom sheet UI, floating cart button</what-built>
  <how-to-verify>
    1. Run: npm run dev
    2. **Test on mobile device or emulator (viewport <768px):**
       - Use Chrome DevTools device emulation or real mobile device
       - Set viewport to iPhone 14 Pro (390x844) or similar
    3. **Test swipeable gallery:**
       - Visit any product detail page
       - Swipe left/right on product image
       - Verify smooth image transitions with momentum
       - Check dots indicator updates correctly
       - Try swiping at edges (should bounce back)
       - Confirm partial peek of next/previous images
    4. **Test bottom sheet:**
       - Go to /produits catalog page
       - Tap "Filtres" button (should be visible at bottom)
       - Verify sheet slides up from bottom
       - Try swiping down to close (drag handle area)
       - Tap backdrop to close
       - Open again and apply filters - confirm filters work
       - Test quick-view: tap product "Aperçu rapide" button
       - Verify quick-view opens in bottom sheet (not modal)
    5. **Test floating cart button:**
       - Scroll down product catalog page
       - Verify FAB appears after 200px scroll
       - Check button positioned in bottom-right thumb zone
       - Add item to cart, verify badge shows count
       - Tap FAB, confirm navigation to cart page
       - Check badge animates when count changes
       - Verify FAB hidden on cart/checkout pages
    6. **Desktop verification:**
       - Switch to desktop viewport (>768px)
       - Confirm swipeable gallery reverts to click/thumbnail behavior
       - Verify bottom sheet not used (modal for quick-view)
       - Confirm FAB hidden (header cart button shown instead)
    7. **Touch interaction quality:**
       - All gestures feel natural and responsive
       - No lag or jank during swipes/drags
       - Animations smooth (60fps)
       - Touch targets large enough (minimum 44x44px)
       - Scrolling works correctly (no conflict with swipes)
  </how-to-verify>
  <resume-signal>Type "approved" to continue, or describe specific issues to fix</resume-signal>
</task>

</tasks>

<verification>
Before declaring plan complete:
- [ ] npm run build succeeds with no errors
- [ ] Swipeable gallery works on mobile with smooth momentum
- [ ] Bottom sheet slides up/down with native feel
- [ ] Floating cart button positioned in thumb zone
- [ ] Badge shows cart count and animates on change
- [ ] All mobile gestures responsive and smooth
- [ ] Desktop fallbacks work correctly
- [ ] No scroll conflicts or gesture interference
- [ ] Touch targets meet accessibility standards (44px min)
- [ ] Performance excellent on mobile devices
</verification>

<success_criteria>

- All tasks completed
- Mobile experience matches native app quality
- Swipe gestures natural and momentum-based
- Bottom sheet UI feels native (iOS/Android style)
- Floating cart button thumb-friendly and accessible
- All interactions smooth on touch devices
- Desktop experience unchanged (appropriate fallbacks)
- User tested and approved on mobile device
- No performance issues or gesture conflicts
  </success_criteria>

<output>
After completion, create `.planning/phases/08-character-delight/08-04-SUMMARY.md`
</output>
