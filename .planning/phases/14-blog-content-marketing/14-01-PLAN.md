---
phase: 14-blog-content-marketing
plan: 01
type: execute
wave: 1
depends_on: []
files_modified: [package.json, next.config.ts, mdx-components.tsx, src/app/globals.css, src/types/blog.ts, src/lib/blog.ts, src/lib/seo.ts]
autonomous: true
domain: next-js
---

<objective>
Set up MDX infrastructure and blog utility library for the Nuage blog system.

Purpose: Establish the foundation (packages, config, types, utilities) that blog pages and content will build on.
Output: Working MDX compilation pipeline, blog post type definitions, post listing utility, and Article JSON-LD schema helper.
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-plan.md
@~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/14-blog-content-marketing/14-RESEARCH.md

@next.config.ts
@src/app/globals.css
@src/lib/seo.ts
@package.json
</context>

<tasks>

<task type="auto">
  <name>Task 1: Install MDX packages and configure Next.js + Tailwind</name>
  <files>package.json, next.config.ts, mdx-components.tsx, src/app/globals.css</files>
  <action>
1. Install packages:
   ```
   npm install @next/mdx @mdx-js/loader @mdx-js/react @types/mdx gray-matter reading-time remark-gfm rehype-slug schema-dts
   ```
   Install typography plugin as dev dependency:
   ```
   npm install -D @tailwindcss/typography
   ```

2. Update next.config.ts:
   - Import createMDX from '@next/mdx', remarkGfm from 'remark-gfm', rehypeSlug from 'rehype-slug'
   - Add 'mdx' to pageExtensions: ['js', 'jsx', 'md', 'mdx', 'ts', 'tsx']
   - Create withMDX wrapper with remarkPlugins: [remarkGfm] and rehypePlugins: [rehypeSlug]
   - Export withMDX(nextConfig) instead of plain nextConfig
   - KEEP all existing config (images, compiler, experimental, headers) unchanged

3. Create mdx-components.tsx at project root (NOT in src/):
   - Export useMDXComponents function (required by @next/mdx in App Router)
   - Map 'img' to Next.js Image component for optimization (use responsive width/height defaults)
   - Map 'a' to Next.js Link for internal links (check if href starts with '/')
   - Keep other elements as default

4. Add typography plugin to src/app/globals.css:
   - Add `@plugin "@tailwindcss/typography";` after the `@import "tailwindcss";` line
   - This is the Tailwind v4 way to load plugins (NOT via tailwind.config.js which doesn't exist)
  </action>
  <verify>npm run build succeeds without errors (MDX compilation works)</verify>
  <done>MDX pipeline configured: next.config.ts wraps with MDX, mdx-components.tsx exists at root, typography plugin loaded, all packages installed</done>
</task>

<task type="auto">
  <name>Task 2: Create blog types, utility library, and Article schema</name>
  <files>src/types/blog.ts, src/lib/blog.ts, src/lib/seo.ts</files>
  <action>
1. Create src/types/blog.ts:
   - Export interface BlogPostMeta: slug, title, description, date (string), author (string), category (string, e.g. 'guide' | 'culture' | 'conseils'), image (optional string), readingTime (string)
   - Export type BlogCategory = 'guide' | 'culture' | 'conseils'
   - Export categoryLabels map: { guide: 'Guides', culture: 'Culture', conseils: 'Conseils' }

2. Create src/lib/blog.ts:
   - Import fs, path from node builtins; matter from 'gray-matter'; readingTime from 'reading-time'
   - Define BLOG_DIR = path.join(process.cwd(), 'content', 'blog')
   - Export getAllPosts(): BlogPostMeta[] — reads all .mdx files from BLOG_DIR, parses frontmatter with gray-matter, computes reading time, returns sorted by date descending. Handle case where directory doesn't exist yet (return empty array).
   - Export getPostSlugs(): string[] — returns all .mdx filenames without extension (for generateStaticParams)
   - Export getPostBySlug(slug: string): BlogPostMeta | null — returns metadata for a single post

3. Extend src/lib/seo.ts:
   - Add generateArticleSchema() function that takes: title, description, date, author (default 'Nuage'), image (optional), slug
   - Returns Schema.org Article JSON-LD with @context, @type: 'Article', headline, description, author (Organization type, name: 'Nuage'), datePublished, image (if provided), publisher (Organization, name: 'Nuage', logo), url (https://nuage.fr/blog/{slug})
   - Sanitize JSON output with .replace(/</g, '\\u003c') for XSS prevention (as noted in research pitfall 4)
  </action>
  <verify>TypeScript compiles: npx tsc --noEmit passes with no errors on the new files</verify>
  <done>BlogPostMeta type exported, getAllPosts/getPostSlugs/getPostBySlug utilities work, generateArticleSchema added to seo.ts</done>
</task>

</tasks>

<verification>
Before declaring plan complete:
- [ ] `npm run build` succeeds without errors
- [ ] No TypeScript errors (`npx tsc --noEmit`)
- [ ] mdx-components.tsx exists at project root
- [ ] src/lib/blog.ts exports getAllPosts, getPostSlugs, getPostBySlug
- [ ] src/lib/seo.ts exports generateArticleSchema
</verification>

<success_criteria>

- All packages installed and in package.json
- MDX compilation pipeline works (next.config.ts configured)
- Blog utility functions created and type-safe
- Article JSON-LD schema generator added
- No build errors
  </success_criteria>

<output>
After completion, create `.planning/phases/14-blog-content-marketing/14-01-SUMMARY.md`
</output>
