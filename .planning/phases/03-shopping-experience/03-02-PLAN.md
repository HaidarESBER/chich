---
phase: 03-shopping-experience
plan: 02
type: execute
wave: 2
depends_on: ["03-01"]
files_modified:
  - src/types/order.ts
  - src/types/checkout.ts
  - src/components/checkout/CheckoutForm.tsx
  - src/components/checkout/ShippingForm.tsx
  - src/components/checkout/OrderSummary.tsx
  - src/components/checkout/index.ts
  - src/app/commande/page.tsx
  - src/lib/orders.ts
autonomous: true
---

<objective>
Implement checkout flow with customer information collection and order creation.

Purpose: Enable customers to complete their purchase by providing shipping details and placing an order. MVP focuses on collecting information and creating orders - payment integration will be simulated.
Output: Checkout page with shipping form, order summary, and order placement functionality.
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-plan.md
@~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/03-shopping-experience/03-01-SUMMARY.md

@src/types/product.ts
@src/types/cart.ts
@src/contexts/CartContext.tsx
@src/components/ui/Button.tsx
@src/lib/products.ts
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create order and checkout types</name>
  <files>src/types/order.ts, src/types/checkout.ts</files>
  <action>
Define type system for orders and checkout process.

**src/types/checkout.ts:**
- ShippingAddress: firstName, lastName, email, phone, address, addressLine2 (optional), city, postalCode, country (default "France")
- CheckoutFormData: shippingAddress, notes (optional)
- FormField validation helpers if needed

**src/types/order.ts:**
- OrderStatus: 'pending' | 'confirmed' | 'processing' | 'shipped' | 'delivered' | 'cancelled'
- OrderItem: productId, productName, productImage, price (cents), quantity
- Order: id, orderNumber (human-readable like "NU-2026-0001"), items, subtotal, shipping (0 for now - free shipping), total, status, shippingAddress, createdAt, updatedAt
- Utility: generateOrderNumber function

Use cents for all monetary values consistent with Product type.
  </action>
  <verify>npm run build passes with no type errors</verify>
  <done>Order and checkout types defined with proper structure</done>
</task>

<task type="auto">
  <name>Task 2: Create checkout form components</name>
  <files>src/components/checkout/ShippingForm.tsx, src/components/checkout/OrderSummary.tsx, src/components/checkout/CheckoutForm.tsx, src/components/checkout/index.ts</files>
  <action>
Create checkout UI components following design system.

**src/components/checkout/ShippingForm.tsx:**
- Form fields for ShippingAddress (all required except addressLine2)
- French labels: Prenom, Nom, Email, Telephone, Adresse, Complement d'adresse, Ville, Code postal, Pays
- Use controlled inputs with onChange handlers
- Basic client-side validation (required fields, email format, French postal code 5 digits)
- Error messages below fields in French

**src/components/checkout/OrderSummary.tsx:**
- Display cart items (image, name, quantity, line total)
- Subtotal
- Shipping: "Gratuit" (free shipping for MVP)
- Total
- Compact view suitable for checkout sidebar

**src/components/checkout/CheckoutForm.tsx:**
- Orchestrates ShippingForm and OrderSummary
- Handles form state and validation
- "Confirmer la commande" submit button
- Loading state during submission
- onSubmit callback prop for parent to handle order creation

**src/components/checkout/index.ts:**
- Barrel export all components

All components use 'use client' directive.
  </action>
  <verify>Components render without TypeScript errors</verify>
  <done>Checkout form components created with French labels and validation</done>
</task>

<task type="auto">
  <name>Task 3: Create checkout page and order storage</name>
  <files>src/lib/orders.ts, src/app/commande/page.tsx</files>
  <action>
Implement checkout page and order persistence.

**src/lib/orders.ts:**
- Server Actions file ('use server')
- createOrder: takes cart items + shipping address, creates Order, saves to data/orders.json
- getOrderByNumber: retrieve order by order number
- File-based storage matching products.ts pattern
- Generate unique order number (NU-YYYY-NNNN format)

**src/app/commande/page.tsx:**
- Page title: "Finaliser votre commande"
- Use Container
- Two-column layout on desktop: ShippingForm (2/3) + OrderSummary (1/3)
- Stacked on mobile: Summary first, then form
- Redirect to /panier if cart is empty
- On successful order:
  - Clear cart
  - Redirect to /commande/confirmation/[orderNumber]
- Handle order creation errors gracefully
- 'use client' for cart context access

For MVP: No actual payment processing. Order is created in "pending" status. Payment integration can be added later.
  </action>
  <verify>
1. Navigate to /commande with items in cart
2. Fill form with valid French data
3. Submit - order created, redirected to confirmation
4. Check data/orders.json contains new order
  </verify>
  <done>Checkout page functional, orders persisted to file storage</done>
</task>

</tasks>

<verification>
Before declaring plan complete:
- [ ] `npm run build` succeeds without errors
- [ ] Checkout page accessible at /commande
- [ ] Form validates required fields
- [ ] Order created on submission
- [ ] Cart cleared after successful order
- [ ] Redirects to confirmation page
- [ ] Order saved to data/orders.json
</verification>

<success_criteria>

- All tasks completed
- All verification checks pass
- No TypeScript or build errors
- Complete checkout flow from cart to order creation
- French labels and validation messages
- Free shipping displayed
</success_criteria>

<output>
After completion, create `.planning/phases/03-shopping-experience/03-02-SUMMARY.md`
</output>
