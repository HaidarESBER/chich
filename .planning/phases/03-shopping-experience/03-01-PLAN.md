---
phase: 03-shopping-experience
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - src/types/cart.ts
  - src/contexts/CartContext.tsx
  - src/components/cart/CartItem.tsx
  - src/components/cart/CartSummary.tsx
  - src/components/cart/CartButton.tsx
  - src/components/cart/index.ts
  - src/app/panier/page.tsx
  - src/components/product/ProductCard.tsx
  - src/app/produits/[slug]/page.tsx
  - src/app/layout.tsx
autonomous: true
---

<objective>
Implement shopping cart functionality with persistent state and cart UI.

Purpose: Enable visitors to add products to cart, view cart contents, and modify quantities - the foundation of the shopping experience.
Output: Cart context, cart components, cart page, and integrated "Add to cart" functionality on product pages.
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-plan.md
@~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/02-product-catalog/02-01-SUMMARY.md

@src/types/product.ts
@src/components/ui/Button.tsx
@src/components/product/ProductCard.tsx
@src/app/produits/[slug]/page.tsx
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create cart types and context</name>
  <files>src/types/cart.ts, src/contexts/CartContext.tsx</files>
  <action>
Create cart type system and React context for cart state management.

**src/types/cart.ts:**
- CartItem interface: product (Product), quantity (number)
- Cart interface: items (CartItem[]), computed properties via utility functions
- Utility functions: calculateSubtotal, calculateTotalItems, formatCartTotal

**src/contexts/CartContext.tsx:**
- CartContext with: items, addItem, removeItem, updateQuantity, clearCart
- localStorage persistence (key: "nuage-cart")
- CartProvider wrapper component
- useCart hook for consuming context
- Handle hydration mismatch (client-side only initialization)

Use 'use client' directive. Initialize from localStorage on mount, save to localStorage on changes.
  </action>
  <verify>TypeScript compiles without errors: npm run build</verify>
  <done>Cart types defined, CartContext created with localStorage persistence</done>
</task>

<task type="auto">
  <name>Task 2: Create cart UI components</name>
  <files>src/components/cart/CartItem.tsx, src/components/cart/CartSummary.tsx, src/components/cart/CartButton.tsx, src/components/cart/index.ts, src/app/panier/page.tsx</files>
  <action>
Create cart components following existing design system (Button, Container patterns).

**src/components/cart/CartItem.tsx:**
- Display product image (80x80), name, price, quantity controls (+/-)
- Remove button
- Use formatPrice from product types
- Responsive: stack on mobile, row on desktop

**src/components/cart/CartSummary.tsx:**
- Subtotal display
- "Continuer mes achats" link to /produits
- "Passer la commande" button (link to /commande for now)
- Empty state: message + CTA to browse products

**src/components/cart/CartButton.tsx:**
- Header cart icon with item count badge
- Link to /panier
- Only show count badge when items > 0

**src/components/cart/index.ts:**
- Barrel export all components

**src/app/panier/page.tsx:**
- Page title: "Votre panier"
- CartItem list with CartSummary
- Use Container component
- Handle empty cart gracefully
- Mark as 'use client' since it uses cart context
  </action>
  <verify>Navigate to /panier - page renders without errors</verify>
  <done>Cart page accessible at /panier with item display and summary</done>
</task>

<task type="auto">
  <name>Task 3: Integrate cart into product pages and layout</name>
  <files>src/components/product/ProductCard.tsx, src/app/produits/[slug]/page.tsx, src/app/layout.tsx</files>
  <action>
Connect cart functionality to existing product components.

**src/app/layout.tsx:**
- Wrap children with CartProvider
- Add CartButton to header (next to any existing nav)

**src/components/product/ProductCard.tsx:**
- Convert to client component ('use client')
- Import useCart
- Make "Ajouter au panier" button functional
- Show feedback on add (brief visual indication or rely on cart count update)
- Keep button disabled if !inStock

**src/app/produits/[slug]/page.tsx:**
- Extract add-to-cart button to a separate client component (AddToCartButton)
- Create src/components/product/AddToCartButton.tsx
- AddToCartButton uses useCart, handles quantity (default 1)
- Keep existing page as server component, only the button is client
  </action>
  <verify>
1. Click "Ajouter au panier" on ProductCard - cart count increases
2. Click button on product detail page - item added to cart
3. Visit /panier - items appear correctly
4. Refresh page - cart persists from localStorage
  </verify>
  <done>Products can be added to cart, cart persists across page refreshes</done>
</task>

</tasks>

<verification>
Before declaring plan complete:
- [ ] `npm run build` succeeds without errors
- [ ] Cart page accessible at /panier
- [ ] Add to cart works from product cards
- [ ] Add to cart works from product detail page
- [ ] Cart persists after page refresh
- [ ] Quantity can be modified in cart
- [ ] Items can be removed from cart
- [ ] Cart count shows in header
</verification>

<success_criteria>

- All tasks completed
- All verification checks pass
- No TypeScript or build errors
- Cart functionality complete and persistent
- French labels used throughout (Panier, Ajouter au panier, etc.)
</success_criteria>

<output>
After completion, create `.planning/phases/03-shopping-experience/03-01-SUMMARY.md`
</output>
