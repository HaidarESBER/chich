---
phase: 19-mobile-ux-excellence
plan: 02
type: execute
wave: 2
depends_on: ["19-01"]
files_modified: [
  src/components/mobile/PullToRefresh.tsx,
  src/components/mobile/InstallPrompt.tsx,
  src/app/template.tsx,
  src/app/page.tsx,
  src/app/produits/page.tsx,
  src/app/panier/page.tsx
]
autonomous: false
---

<objective>
Add native app-like features: pull-to-refresh, install prompt, and smooth page transitions for mobile.

Purpose: Create iOS/Android native-like experience with pull-to-refresh gestures, install prompts, and fluid navigation
Output: Mobile-native features integrated throughout site with visual verification
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-plan.md
@~/.claude/get-shit-done/templates/summary.md
@~/.claude/get-shit-done/references/checkpoints.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md

# Current mobile components:
@src/components/mobile/FloatingCartButton.tsx
@src/components/mobile/BottomSheet.tsx
@src/app/layout.tsx
@src/app/template.tsx

# PWA foundation from Plan 01:
Service worker and manifest now in place, app is installable.
</context>

<tasks>

<task type="auto">
  <name>Task 1: Build pull-to-refresh component</name>
  <files>src/components/mobile/PullToRefresh.tsx, src/app/page.tsx, src/app/produits/page.tsx</files>
  <action>
Create PullToRefresh wrapper component at src/components/mobile/PullToRefresh.tsx:

Features:
- Detects pull-down gesture on touch devices
- Shows visual feedback: animated refresh icon
- Threshold: 80px pull distance to trigger
- Smooth spring animation using Framer Motion
- Calls onRefresh callback when threshold met
- Resets after refresh completes
- Haptic feedback if available (navigator.vibrate(50))
- Only active on mobile (<768px)
- Only triggers at scroll position 0 (top of page)

Implementation approach:
```tsx
- Track touch start Y position
- Calculate pull distance on touchmove
- Show refresh indicator when pulling (scale with distance)
- Trigger onRefresh at 80px threshold
- Animate indicator while loading
- Reset on completion
```

Integrate on key pages:
1. Homepage (src/app/page.tsx): Wrap HomeClient with PullToRefresh, onRefresh calls router.refresh()
2. Products page (src/app/produits/page.tsx): Wrap content, refresh reloads product data

Use existing brand colors for refresh indicator (Charcoal spinner on Cream background).
Follow patterns from existing BottomSheet for touch handling.
  </action>
  <verify>Build succeeds, pull-to-refresh works on mobile viewport in DevTools, visual indicator shows during pull, page refreshes on release</verify>
  <done>PullToRefresh component created with touch gesture detection, integrated on homepage and products page, visual feedback matches brand, refreshes trigger router.refresh()</done>
</task>

<task type="auto">
  <name>Task 2: Create install prompt component</name>
  <files>src/components/mobile/InstallPrompt.tsx, src/app/layout.tsx</files>
  <action>
Create InstallPrompt component at src/components/mobile/InstallPrompt.tsx:

Features:
- Listens for beforeinstallprompt event
- Shows elegant banner after 3 seconds on first visit
- Banner design: Bottom slide-up, brand colors, "Installer l'application" CTA
- "Ajouter à l'écran d'accueil" subtext
- Dismiss button (X icon)
- Triggers native install prompt on CTA click
- Dismisses after install or on X click
- Stores dismissal in localStorage (don't show again)
- Only shows on mobile (<768px)
- Smooth slide-up animation using Framer Motion

Implementation:
```tsx
- useEffect to capture beforeinstallprompt event
- Save prompt reference in state
- Show banner after 3s delay (if not dismissed before)
- onClick: call prompt.prompt(), check result, hide banner
- onDismiss: hide banner, set localStorage flag
```

Banner style:
- Fixed bottom position (above FloatingCartButton)
- Cream background with Charcoal text
- Nuage logo icon
- Primary button style for "Installer"
- Subtle shadow for elevation

Add to layout.tsx after FloatingCartButton (mobile-only, non-intrusive).
  </action>
  <verify>Build succeeds, banner appears on mobile after 3s (only if PWA not installed), clicking "Installer" triggers native prompt, dismissing hides banner permanently</verify>
  <done>InstallPrompt component created, shows 3s after page load on mobile, triggers native install prompt, dismissal persisted in localStorage, integrated in layout.tsx</done>
</task>

<task type="auto">
  <name>Task 3: Add app-like page transitions</name>
  <files>src/app/template.tsx</files>
  <action>
Enhance existing template.tsx (or create if missing) with smooth page transitions:

Use Framer Motion for view transitions between pages:
```tsx
<motion.div
  initial={{ opacity: 0, x: 20 }}
  animate={{ opacity: 1, x: 0 }}
  exit={{ opacity: 0, x: -20 }}
  transition={{ duration: 0.3, ease: 'easeInOut' }}
>
  {children}
</motion.div>
```

Features:
- Fade + slide transitions (iOS/Android native-like)
- 300ms duration (matches brand animation timing)
- Forward navigation: slide left (x: 20 → 0)
- Back navigation: slide right (x: -20 → 0)
- Smooth easing curve
- Does not interfere with existing scroll animations
- Works on all viewport sizes

Note: template.tsx is automatically wrapped around page content by Next.js App Router.
This creates seamless transitions between page navigations.

Also add loading state for route changes (optional):
- Simple top progress bar using NProgress or custom implementation
- Matches brand colors

Keep transitions subtle - premium feel, not distracting.
  </action>
  <verify>Build succeeds, navigating between pages shows smooth fade+slide transition, transition timing feels natural, no layout shift during transitions</verify>
  <done>template.tsx enhanced with Framer Motion page transitions, fade+slide animation between pages, 300ms duration with easeInOut, native app-like navigation feel</done>
</task>

<task type="checkpoint:human-verify" gate="blocking">
  <what-built>Mobile-native features: pull-to-refresh on key pages, install prompt banner, app-like page transitions</what-built>
  <how-to-verify>
    1. Open DevTools, toggle device toolbar (mobile viewport)
    2. Navigate to homepage (http://localhost:3000)
    3. Pull down from top of page → verify refresh indicator appears
    4. Release after pulling 80px → verify page refreshes
    5. Wait 3 seconds → verify "Installer l'application" banner slides up from bottom
    6. Click "Installer" → verify native install prompt appears (if supported)
    7. Dismiss banner → verify it hides and doesn't reappear
    8. Navigate between pages (home → produits → panier) → verify smooth fade+slide transitions
    9. Test on real mobile device if possible (for haptic feedback and native prompt)
    10. Verify all features work without breaking existing functionality
  </how-to-verify>
  <resume-signal>Type "approved" to continue, or describe any issues</resume-signal>
</task>

</tasks>

<verification>
Before declaring plan complete:
- [ ] PullToRefresh component works on mobile
- [ ] Pull gesture triggers refresh after 80px threshold
- [ ] InstallPrompt banner appears after 3s on first mobile visit
- [ ] Native install prompt triggered on CTA click
- [ ] Banner dismissal persists across page loads
- [ ] Page transitions smooth between all routes
- [ ] No layout shift or visual glitches during transitions
- [ ] All features work on mobile viewport (<768px)
- [ ] No console errors or warnings
- [ ] User confirmed visual quality in checkpoint
</verification>

<success_criteria>

- Pull-to-refresh integrated on homepage and products page
- Refresh indicator shows visual feedback during pull
- InstallPrompt banner shows after 3s on mobile
- Install prompt triggers native "Add to Home Screen" dialog
- Banner dismissal stored in localStorage
- Page transitions with fade+slide animation (300ms)
- All transitions feel smooth and native-like
- Mobile UX now matches iOS/Android native apps
- Visual verification passed by user
  </success_criteria>

<output>
After completion, create `.planning/phases/19-mobile-ux-excellence/19-02-SUMMARY.md`
</output>
