---
phase: 04-launch-prep
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - src/app/admin/commandes/page.tsx
  - src/app/admin/commandes/[id]/page.tsx
  - src/components/admin/OrderStatusBadge.tsx
  - src/components/admin/OrderStatusSelect.tsx
  - src/components/admin/index.ts
  - src/app/admin/layout.tsx
  - src/app/admin/page.tsx
autonomous: true
---

<objective>
Build order management admin interface with order list, order detail with status updates, and dashboard order statistics.

Purpose: Enable admin to view and manage customer orders, track fulfillment status, and see order metrics on dashboard.
Output: Admin orders pages with status management and dashboard stats.
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-plan.md
@~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md

# Prior phase context
@.planning/phases/03-shopping-experience/03-02-SUMMARY.md

# Relevant source files
@src/lib/orders.ts
@src/types/order.ts
@src/app/admin/produits/page.tsx
@src/app/admin/page.tsx
@src/app/admin/layout.tsx
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create admin order components</name>
  <files>src/components/admin/OrderStatusBadge.tsx, src/components/admin/OrderStatusSelect.tsx, src/components/admin/index.ts</files>
  <action>
Create two admin components for order status:

1. OrderStatusBadge.tsx - Display-only status badge with color coding:
   - pending: yellow/amber
   - confirmed: blue
   - processing: purple
   - shipped: teal
   - delivered: green
   - cancelled: red
   Use Tailwind classes matching existing admin styles. Show French labels from orderStatusLabels.

2. OrderStatusSelect.tsx - Client component with dropdown to change status:
   - Accept orderId, currentStatus, and optional onStatusChange callback as props
   - Use native select styled to match admin aesthetic
   - Call updateOrderStatus Server Action on change
   - Show loading state during update
   - Refresh page after successful update using router.refresh()

Export both from components/admin/index.ts barrel file (add to existing exports).
  </action>
  <verify>TypeScript compiles: npm run build</verify>
  <done>OrderStatusBadge and OrderStatusSelect components exported from admin barrel</done>
</task>

<task type="auto">
  <name>Task 2: Create admin orders list and detail pages</name>
  <files>src/app/admin/commandes/page.tsx, src/app/admin/commandes/[id]/page.tsx</files>
  <action>
Create admin orders pages following existing admin/produits pattern:

1. Admin Orders List (src/app/admin/commandes/page.tsx):
   - Header with "Commandes" title (no add button - orders come from customers)
   - Table with columns: Numero, Client, Date, Total, Statut, Actions
   - Use getAllOrders() to fetch orders
   - Format date as "DD/MM/YYYY" using toLocaleDateString('fr-FR')
   - Format total with formatPrice from product types (cents to euros)
   - Show OrderStatusBadge for status
   - "Voir" link to detail page
   - Empty state: "Aucune commande pour le moment."
   - Use force-dynamic export

2. Admin Order Detail (src/app/admin/commandes/[id]/page.tsx):
   - Fetch order by ID using getOrderById
   - Show 404-style message if not found
   - Header with order number and OrderStatusSelect
   - Two-column layout on desktop:
     - Left: Order items (image, name, qty, price, line total)
     - Right: Shipping address and order totals
   - Back link to orders list
   - Use force-dynamic export
  </action>
  <verify>Navigate to /admin/commandes and /admin/commandes/[id] - pages render without errors</verify>
  <done>Admin orders list shows all orders, detail page shows order info with status selector</done>
</task>

<task type="auto">
  <name>Task 3: Add orders to admin navigation and dashboard</name>
  <files>src/app/admin/layout.tsx, src/app/admin/page.tsx, src/lib/orders.ts</files>
  <action>
Integrate orders into admin:

1. Add getOrderStats function to src/lib/orders.ts:
   - Return { total, pending, processing, shipped, delivered }
   - Count orders by status

2. Update admin layout sidebar (src/app/admin/layout.tsx):
   - Add "Commandes" link after "Produits" pointing to /admin/commandes

3. Update admin dashboard (src/app/admin/page.tsx):
   - Import getOrderStats
   - Add new stats row below product stats:
     - "Total Commandes" - total count
     - "En attente" - pending count (highlight if > 0)
     - "En cours" - processing count
   - Add quick action link: "Voir les commandes" -> /admin/commandes
  </action>
  <verify>Admin sidebar shows Commandes link, dashboard shows order stats</verify>
  <done>Admin navigation includes orders, dashboard shows order metrics</done>
</task>

</tasks>

<verification>
Before declaring plan complete:
- [ ] npm run build succeeds
- [ ] /admin/commandes lists all orders from data/orders.json
- [ ] /admin/commandes/[id] shows order detail with status dropdown
- [ ] Status changes persist to orders.json
- [ ] Dashboard shows order statistics
- [ ] Admin sidebar has Commandes link
</verification>

<success_criteria>
- All tasks completed
- All verification checks pass
- Order management works end-to-end
- Consistent with existing admin UI patterns
</success_criteria>

<output>
After completion, create `.planning/phases/04-launch-prep/04-01-SUMMARY.md`
</output>
