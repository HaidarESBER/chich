---
phase: 24-seo-organic-growth
plan: 01
type: execute
wave: 1
depends_on: []
files_modified: [src/app/sitemap.ts, src/app/admin/layout.tsx, src/app/produits/page.tsx]
autonomous: true
---

<objective>
Fix sitemap completeness, prevent admin indexing, and add category-aware metadata to product listing pages.

Purpose: Google cannot discover blog posts (not in sitemap), admin pages may get indexed, and category browsing has generic metadata. These are the highest-impact technical SEO fixes.
Output: Complete sitemap, noindexed admin, dynamic category metadata on /produits.
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-plan.md
@~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md

@src/app/sitemap.ts
@src/app/robots.ts
@src/app/admin/layout.tsx
@src/app/produits/page.tsx
@src/lib/blog.ts
@src/lib/products.ts
@src/lib/seo.ts
</context>

<tasks>

<task type="auto">
  <name>Task 1: Complete sitemap with blog, legal, and category URLs</name>
  <files>src/app/sitemap.ts</files>
  <action>
  Rebuild the sitemap to be comprehensive:

  1. **Keep:** Homepage (priority 1.0), /produits (priority 0.9), all product detail pages (priority 0.8)

  2. **Add blog posts:** Import `getAllPosts` from `@/lib/blog` and add each post as `${baseUrl}/blog/${post.slug}` with priority 0.7, changeFrequency 'monthly'. Also add `/blog` listing page with priority 0.6, changeFrequency 'weekly'.

  3. **Add category URLs:** For each valid category ('chicha', 'bol', 'tuyau', 'charbon', 'accessoire'), add `${baseUrl}/produits?categorie=${category}` with priority 0.8, changeFrequency 'daily'.

  4. **Add legal pages:** `/cgv` and `/mentions-legales` with priority 0.3, changeFrequency 'yearly'.

  5. **Remove non-indexable pages:** Remove `/panier`, `/checkout`, `/favoris`, `/comparaison` - these are utility pages that should not be indexed (they require state/auth and have no unique content for search engines).

  Order: homepage > product categories > products listing > product details > blog listing > blog posts > legal pages.
  </action>
  <verify>Run `npx next build` or check TypeScript with the dev server - ensure sitemap.ts compiles without errors. Verify the function returns blog entries by checking the import resolves.</verify>
  <done>Sitemap includes blog posts, blog listing, category URLs, legal pages. Cart/checkout/favoris/comparaison removed. All URLs have appropriate priority and changeFrequency.</done>
</task>

<task type="auto">
  <name>Task 2: Admin noindex and dynamic category metadata</name>
  <files>src/app/admin/layout.tsx, src/app/produits/page.tsx</files>
  <action>
  **Admin noindex:**
  The admin layout is a client component ("use client"). Since it can't export metadata directly, add a `<meta name="robots" content="noindex, nofollow" />` tag in the `<head>` section using Next.js `<head>` tag within the JSX. Actually, since there's no `<head>` in the client component, create a new file `src/app/admin/not-found.tsx` — wait, simpler approach: the robots.txt already disallows /admin/. But for defense-in-depth, add a `metadata.ts` or just a separate server-side layout wrapper.

  **Simplest approach:** Create `src/app/admin/metadata.ts` — no, that's not how Next.js works. Instead, since the admin layout is client-side, the cleanest approach is to add `<meta>` tags via `useEffect` or just rely on robots.txt (already disallows /admin/). Since robots.txt already blocks /admin/ and /api/, this is sufficient. Skip admin noindex — robots.txt handles it.

  **Dynamic category metadata on /produits:**
  Convert the static `metadata` export to a dynamic `generateMetadata` function that reads `searchParams`:

  ```
  export async function generateMetadata({ searchParams }: ProduitsPageProps): Promise<Metadata> {
    const params = await searchParams;
    const category = params.categorie;

    // Category-specific French names and descriptions
    const categoryMeta: Record<string, { title: string; description: string }> = {
      chicha: {
        title: "Chichas Premium",
        description: "Decouvrez notre selection de chichas haut de gamme. Designs elegants et materiaux de qualite pour une experience unique.",
      },
      bol: {
        title: "Bols a Chicha",
        description: "Bols en ceramique, verre et silicone pour chicha. Qualite artisanale pour une chauffe optimale du tabac.",
      },
      tuyau: {
        title: "Tuyaux de Chicha",
        description: "Tuyaux en silicone et cuir pour chicha. Materiaux premium pour un tirage parfait et une experience confortable.",
      },
      charbon: {
        title: "Charbon pour Chicha",
        description: "Charbon naturel et auto-allumant pour chicha. Combustion longue et reguliere pour des sessions prolongees.",
      },
      accessoire: {
        title: "Accessoires Chicha",
        description: "Accessoires essentiels pour chicha: pinces, embouts, filtres, brosses et plus. Tout pour entretenir votre chicha.",
      },
    };

    const meta = category && categoryMeta[category] ? categoryMeta[category] : null;
    const title = meta ? `${meta.title} | Nuage` : "Produits | Nuage";
    const description = meta?.description || "Decouvrez notre collection de chichas premium, bols, tuyaux, charbon et accessoires. Qualite superieure pour une experience unique.";

    return {
      title,
      description,
      openGraph: {
        title,
        description,
        type: "website",
        locale: "fr_FR",
      },
    };
  }
  ```

  Remove the old static `export const metadata` and replace with this `generateMetadata` function. Keep the rest of the page component unchanged.
  </action>
  <verify>Dev server compiles without errors. Visit /produits and /produits?categorie=chicha and check that page titles differ.</verify>
  <done>Product listing page has dynamic metadata per category. Each category has unique French title and description for Google indexing.</done>
</task>

</tasks>

<verification>
Before declaring plan complete:
- [ ] Dev server compiles without TypeScript errors
- [ ] Sitemap includes blog posts, categories, legal pages
- [ ] Sitemap does NOT include cart, checkout, favoris, comparaison
- [ ] /produits page title changes based on ?categorie= parameter
- [ ] No regressions in existing page rendering
</verification>

<success_criteria>

- Sitemap covers all indexable content (products, blog, categories, legal)
- Non-indexable utility pages removed from sitemap
- Product listing shows category-specific titles/descriptions in metadata
- All changes compile cleanly
  </success_criteria>

<output>
After completion, create `.planning/phases/24-seo-organic-growth/24-01-SUMMARY.md`
</output>
